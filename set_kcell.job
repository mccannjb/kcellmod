#!/bin/bash

## Script: Set_KCELL
##
## Author: James McCann (mccannjb (at) gmail (dot) com)
##
## Accompanies: kcellmod, kcellPrep
##
## This script will execute the kcellmod program with the appropriate
## input files and format. This script should be modified to handle
## the desired number of input files or should be run for each batch
## of outputs from kcellPrep.
##
##  

## kcellmod program location
EXECL=/nas02/home/m/c/mccannjb/Utils/kcellmod/kcellmod.linux
#EXECL=echo

## Original point source directory and file
PTDIR=$HOME/netscr/EPA/12EUS1_F/ptsrce

## kcellPrep result directory
KCDIR=$HOME/Utils/kcellmod/Test

cd ${PTDIR}

## Implement for loop for number of kcellPrep output files
for camx in *.camx
do
mv ${camx} ${camx}.temp
for file in `ls $KCDIR/*.out`
do
# Parse the number from kcellPrep output file (WARNING: file names must contain only ONE number!)
num=`echo ${file##*/} | sed -e 's/[^0-9]//g'`
num=$(printf "%02d" $num)
# Execute kcellmod for the specified inputs
$EXECL << ieof
CAMx source file   |${PTDIR}/${camx}.temp
New CAMx output    |${PTDIR}/PITTSB01/GRP${num}/${camx}
kcell input file   |${file}
emiss red. factor  |1.00
ieof
done
done

echo "Completed kcell modifications"
